define(["exports","jquery","lodash","navigation/navigation","windows/tracker","moment","../workspace/workspace.js","jquery.dialogextend","modernizr","common/util","css!windows/windows.css"],function(e,t,n,a,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.event_off=e.event_on=e.makeSelectmenu=e.createBlankWindow=e.init=void 0;var s=u(t),d=u(n),l=(u(a),u(i)),f=u(o),c=u(r);function u(e){return e&&e.__esModule?e:{default:e}}function g(t){t=s.default.extend({title:"title",date:null,changed:function(){},cleared:function(){},addDateDropDowns:!0},t);var n,e,a,i,o,r,d=this.parent().find(".ui-dialog-title").addClass("with-content"),l=null,c=(0,s.default)('<span style="line-height: 24px; position: relative; left: 10px"></span>'),u=(n={date:t.date||new Date,onchange:function(e){c.text(e),l&&l.update(e),t.changed(e)},onclear:function(){l&&l.clear(),t.cleared()}},e=(0,s.default)("<input type='hidden' />").insertAfter(d),a={showOn:"both",numberOfMonths:1,maxDate:t.maxDate?t.maxDate:0,minDate:new Date(2010,0,1),dateFormat:"yy-mm-dd",showAnim:"drop",showButtonPanel:!0,changeMonth:!0,changeYear:!0,onSelect:function(){(0,s.default)(this).change()},beforeShow:function(e,t){t.dpDiv.css({marginTop:"10px",marginLeft:"-220px"})},closeText:"Done".i18n(),currentText:"Today".i18n()},i=e.datepicker(a).datepicker("setDate",n.date.toISOString().slice(0,10)),s.default.datepicker._gotoToday=function(e){(0,s.default)(e).datepicker("setDate",new Date).change().datepicker("hide")},i.next("button").text("").button({icons:{primary:"ui-icon-calendar"}}),e.on("change",function(){var e=(0,s.default)(this).val();n.onchange&&n.onchange(e)}),e);return t.addDateDropDowns?(o=t.date,(r=(0,s.default)('<input placeholder="Select date" readonly class="windows-dateInput" />').insertAfter(d)).on("click",function(){return u.datepicker("show")}),o&&r.val((0,f.default)(o).format("DD MMM, YYYY")),l={update:function(e){return r.val(f.default.utc(e,"YYYY-MM-DD").format("DD MMM, YYYY"))},clear:function(){return r.val("")}}):(c.insertAfter(d),c.text(t.date.toISOString().slice(0,10))),(0,s.default)('<span class="span-in-dialog-header">'+t.title+"</span>").insertAfter(d),{clear:function(){return l&&l.clear()}}}function h(){var e=(0,s.default)(".addiction-warning").height(),t=(0,s.default)(document).height()-(0,s.default)(window).height()-(0,s.default)(window).scrollTop();(0,s.default)("#dialog-extend-fixed-container").css("bottom",Math.max(0,e-t))}var m=0,p={},w=e.init=function(){var t=s.default.fn.dialog;return s.default.fn.dialog=function(e){try{return"destroy"===e?(this.trigger("dialogdestroy"),t.call(this,"destroy")):t.apply(this,arguments)}catch(e){s.default.growl.error({message:e.message})}},require(["charts/chartWindow","websockets/binary_websockets","navigation/menu","trade/tradeDialog"],function(n,a,i,o){l.default.is_empty()?a.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(e){var t=(e=i.extractChartableMarkets(e))[0].submarkets[0].instruments[0];a.send({contracts_for:t.symbol}).then(function(e){n.addNewWindow({instrumentCode:t.symbol,instrumentName:t.display_name,timePeriod:"1t",type:"line",delayAmount:t.delay_amount}),o.init({symbol:t.symbol,display_name:t.display_name,pip:"0.001"},e.contracts_for),c.default.tileDialogs()}).catch(function(e){})}):l.default.reopen()}),require(["websockets/binary_websockets"],function(n){local_storage.get("oauth")&&n.cached.authorize().then(function(e){var t=[e],n=local_storage.get("oauth");t.forEach(function(t){t.authorize&&(n.find(function(e){return e.id==t.authorize.loginid}).currency=t.authorize.currency)}),local_storage.set("oauth",n);for(var a=!1,i=0;i<t.length;++i)n[i].id=t[i].authorize.loginid,n[i].is_virtual=t[i].authorize.is_virtual,-1!==t[i].authorize.landing_company_name.indexOf("japan")&&(a=!0);return local_storage.set("oauth",n),a}).then(function(e){e&&!0===e&&(n.invalidate(),s.default.growl.error({message:"Japan accounts are not supported.".i18n(),duration:6e3}),local_storage.remove("oauth"),local_storage.remove("oauth-login"))}).catch(function(e){"SelfExclusion"!==e.code?(s.default.growl.error({message:e.message}),local_storage.remove("oauth"),(0,s.default)(".login").trigger("login-error")):oauth.forEach(function(e,t){e.id.match(/^VRTC/)&&n.switch_account(e.id)})})}),(0,s.default)(window).scroll(h),this},v=e.createBlankWindow=function(e,t){e=(0,s.default)(e);var n="windows-dialog-"+ ++m;(t=s.default.extend({autoOpen:!1,resizable:!0,collapsable:!1,draggable:!0,width:350,height:400,my:"center",at:"center",of:window,title:"Blank window".i18n(),id:m,icons:{close:"custom-icon-close",minimize:"custom-icon-minimize",maximize:"custom-icon-maximize",restore:"custom-icon-restore"}},t||{})).minWidth=t.minWidth||t.width,t.minHeight=t.minHeight||t.height,t.resize&&(t.maximize=t.minimize=t.restore=t.resize);var o=e.attr("id",n);t.ignoreTileAction||o.addClass("webtrader-dialog"),o.dialog(t).dialogExtend(t);var r=o.dialog("widget");r.addClass("webtrader-dialog-widget"),!1!==t.draggable&&(r.draggable("option","containment",!1),r.draggable("option","scroll",!0)),r.on("dragstop",function(){var e=r.offset().top,t=r.offset().left,n=o.dialog("option","width"),a=(0,s.default)(window).width(),i=(0,s.default)("#nav-menu .container").height();e<i+36&&r.animate({top:i+36+"px"},300,r.trigger.bind(r,"animated")),t<0&&r.animate({left:"0px"},300,r.trigger.bind(r,"animated")),a<t+n&&r.animate({left:a-n-10+"px"},300,r.trigger.bind(r,"animated"))}),t.destroy&&o.on("dialogdestroy",t.destroy),o.on("dialogopen",function(){var n=this;d.default.defer(function(){var e=["#msg-notification","#topbar","#nav-menu"].map(function(e){return(0,s.default)(e).outerHeight()}).reduce(function(e,t){return e+t},0),t=(0,s.default)(n).parent();t.css("top")&&+t.css("top").replace("px","")<=e&&t.animate({top:e+(15*Math.random()|0),left:"+="+((10*Math.random()|0)-20)+"px"},300,r.trigger.bind(r,"animated"))}),"Manage"!==t.title&&c.default.addDialog(t.title,t.id,o.moveToTop,function(){return o.dialog("close")})}),o.moveToTop=function(){o.dialog("open"),o.dialogExtend("restore"),o.dialog("widget").effect("bounce",{times:2,distance:15},450)};t.ignoreTileAction||o.on("dialogclose",function(){o.dialogExtend("restore"),c.default.removeDialog(t.id)}),t.resize&&t.resize.call(e[0]),o.addDateToHeader=g,Object.keys(t).filter(function(e){return d.default.startsWith(e,"data-")}).forEach(function(e){return o.attr(e,t[e])}),t.refresh&&o.parent().find(".ui-dialog-title").append("<img class='reload' src='images/refresh.svg' title='reload'/>").find(".reload").on("click",t.refresh);return o.track=function(e){return l.default.track(e,o)},o.destroy=function(){o.data("ui-dialog")&&o.dialog("destroy"),o.remove()},o},y=e.makeSelectmenu=function(n,t){(t=s.default.extend({list:["empty"],inx:0,changed:function(){}},t)).changed=t.changed?t.changed:function(){};function a(e){n.children().remove();for(var t=0;t<e.length;++t)(0,s.default)("<option/>").val(e[t]).text(e[t]).appendTo(n)}var e=t.inx,i=t.list;return a(i),n.val(i[e]),(n=n.selectmenu({classes:{"ui-selectmenu-button":"ui-selectmenu-button ui-state-default"},width:t.width})).on("selectmenuchange",function(){var e=(0,s.default)(this).val();t.changed(e)}),n.update_list=function(e){a(e),n.val(e[0]),n.selectmenu("refresh")},n};e.event_on=function(e,t){return(p[e]=p[e]||[]).push(t),t},e.event_off=function(e,t){if(p[e]){var n=p[e].indexOf(t);-1!==n&&p[e].splice(n,1)}};e.default={init:w,createBlankWindow:v,makeSelectmenu:y}});