define(["exports","babel-runtime/regenerator","jquery","../websockets/binary_websockets","lodash","../tc/tc","../common/util"],function(t,e,n,a,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var o=f(e),l=f(n),r=f(a),c=f(i),u=f(s);function f(t){return t&&t.__esModule?t:{default:t}}var _=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],a=!0,i=!1,s=void 0;try{for(var r,c=t[Symbol.iterator]();!(a=(r=c.next()).done)&&(n.push(r.value),!e||n.length!==e);a=!0);}catch(t){i=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(i)throw s}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function d(t){return function(){var c=t.apply(this,arguments);return new Promise(function(s,r){return function e(t,n){try{var a=c[t](n),i=a.value}catch(t){return void r(t)}if(!a.done)return Promise.resolve(i).then(function(t){e("next",t)},function(t){e("throw",t)});s(i)}("next")})}}function h(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function m(t){(0,l.default)(".webtrader-dialog").parent().each(function(){+(0,l.default)(this).css("top").replace("px","")<=t&&(0,l.default)(this).animate({top:t+"px"},300)})}var p,g=!1,v=(function(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}(b,[{key:"onLogin",value:(p=d(o.default.mark(function t(e){var n,a,i,s,r,c,u;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,l.default)("#msg-notification"),1==+e.authorize.is_virtual)return n.is(":visible")&&n.slideUp(500),g=!1,m(115),t.abrupt("return");t.next=6;break;case 6:return t.next=8,this.getStatus(e.authorize);case 8:a=t.sent,i=_(a,5),s=i[0],r=i[1],c=i[2],i[3],u=i[4],this.tc_accepted=!1,this.financial_assessment_submitted=!0,this.is_mlt=/^malta$/gi.test(e.authorize.landing_company_name),this.is_mf=/^maltainvest$/gi.test(e.authorize.landing_company_name),this.is_cr=/^svg|costarica$/gi.test(e.authorize.landing_company_name),this.has_mt5_account=0<u.mt5_login_list.length,this.is_authenticated=!+s.get_account_status.prompt_client_to_authenticate,r&&r.website_status&&c&&c.get_settings&&(this.tc_accepted=r.website_status.terms_conditions_version===c.get_settings.client_tnc_status),"high"!==s.get_account_status.risk_classification&&!this.is_mf||(this.financial_assessment_submitted=-1==s.get_account_status.status.indexOf("financial_assessment_not_complete")),this.checkStatus(e.authorize,s.get_account_status.status);case 25:case"end":return t.stop()}},t,this)})),function(t){return p.apply(this,arguments)})},{key:"getStatus",value:function(){return Promise.all([r.default.send({get_account_status:1}),r.default.cached.send({website_status:1}),r.default.cached.send({get_settings:1}),r.default.cached.send({get_financial_assessment:1}),r.default.send({mt5_login_list:1})])}},{key:"checkStatus",value:function(t,e){function n(t){var e=getBinaryUrl(t);window.open(e,"_blank")}var a=(0,l.default)("#msg-notification"),i=this,s={excluded_until:{message:"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return 0==local_storage.get("excluded")},callback:function(){return n("contact")}},tc:{message:"Please [_1]accept the updated Terms and Conditions[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return i.tc_accepted},callback:u.default.init},risk:{message:"Please complete the [_1]financial assessment form[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return i.financial_assessment_submitted},callback:function(){return n("user/settings/assessmentws")}},tax:{message:"Please [_1]complete your account profile[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return!i.is_mf||/crs_tin_information/.test(e)},callback:function(){return n("user/settings/detailsws")}},currency:{message:"Please set the [_1]currency[_2] of your account".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return local_storage.get("currency")},callback:function(){return n("user/set-currency")}},authenticate:{message:"[_1]Authenticate your account[_2] now to take full advantage of all withdrawal options available.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return i.is_authenticated},callback:function(){return n("user/authenticate")}},unwelcome:{message:"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return!/(unwelcome|(cashier|withdrawal)_locked)/.test(e)},callback:function(){return n("contact")}}},r=c.default.find(s,function(t){return!t.is_valid()});g=r?(a.html(r.message),a.find("a").on("click",r.callback),a.slideDown(500),m(140),!0):(a.is(":visible")&&a.slideUp(500),m(115),!1)}}]),b);function b(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,b),r.default.events.on("login",this.onLogin.bind(this)),r.default.events.on("reset_accountstatus",function(t){var e=(0,l.default)("#msg-notification");e.is(":visible")&&e.slideUp(500),g=!1})}var y=t.init=new v;t.default={init:y,recheckStatus:function(t){return y.onLogin({authorize:t})},is_shown:function(){return g}}});