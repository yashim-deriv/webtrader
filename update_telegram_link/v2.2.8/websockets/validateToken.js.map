{"version":3,"sources":["../../../../src/websockets/validateToken.es6"],"names":["lang","local_storage","get","value","url","socket_url","app_id","token","Promise","resolve","reject","ws","WebSocket","addEventListener","send","JSON","stringify","data","parse","msg","authorize","close","event","error"],"mappings":";;;;;;AAAA;;;;;;;;;;;;AAeA,MAAMA,OAAO,CAACC,cAAcC,GAAd,CAAkB,MAAlB,KAA6B,EAACC,OAAM,IAAP,EAA9B,EAA4CA,KAAzD;AACA,MAAMC,MAAMC,gCAAa,UAAb,GAA0BC,yBAA1B,GAAmC,KAAnC,GAA0CN,IAAtD;;oBAEe,UAACO,KAAD,EAAW;AACxB,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAMC,KAAK,IAAIC,SAAJ,CAAcR,GAAd,CAAX;;AAEAO,SAAGE,gBAAH,CAAoB,MAApB,EAA4B,YAAM;AAChCF,WAAGG,IAAH,CAAQC,KAAKC,SAAL,CAAe;AACrB,uBAAaT;AADQ,SAAf,CAAR;AAGD,OAJD;AAKAI,SAAGE,gBAAH,CAAoB,OAApB,EAA6B,YAAM,CAAE,CAArC;AACAF,SAAGE,gBAAH,CAAoB,SAApB,EAA+B,eAAO;AACpC,YAAMI,OAAOF,KAAKG,KAAL,CAAWC,IAAIF,IAAf,CAAb;AACAR,gBAAQQ,KAAKG,SAAb;AACAT,WAAGU,KAAH;AACD,OAJD;;AAMAV,SAAGE,gBAAH,CAAoB,OAApB,EAA6B,UAACS,KAAD;AAAA,eAAWZ,OAAOY,MAAMC,KAAb,CAAX;AAAA,OAA7B;AACD,KAhBM,CAAP;AAiBD,G","file":"validateToken.js","sourcesContent":["/**\n * Created by Arnab Karmakar on 11/13/17.\n *\n * History -\n *  CopyTrader and MAM are two modules in Webtrader which requires token validation.\n *  This token is not user's token. It is either traders' or other users' token.\n *  In order to understand more about what these tokens are, please visit these screens.\n *  I had a detailed discussion with backend team. As of 13th Nov 2017, either there\n *  are no backend resources to create new API for token validation or they are\n *  reluctant to do so. Based on my discussion with Tom, he recommended this approach\n *  for now.\n */\nimport 'common/util';\nimport { socket_url, app_id } from 'websockets/binary_websockets';\n\nconst lang = (local_storage.get('i18n') || {value:\"en\"}).value;\nconst url = socket_url + '?app_id=' + app_id + '&l=' +lang;\n\nexport default (token) => {\n  return new Promise((resolve, reject) => {\n    const ws = new WebSocket(url);\n\n    ws.addEventListener('open', () => {\n      ws.send(JSON.stringify({\n        \"authorize\": token\n      }));\n    });\n    ws.addEventListener('close', () => {});\n    ws.addEventListener('message', msg => {\n      const data = JSON.parse(msg.data);\n      resolve(data.authorize);\n      ws.close();\n    });\n\n    ws.addEventListener('error', (event) => reject(event.error));\n  });\n};\n"]}