{"version":3,"sources":["../../../../src/navigation/menu.es6"],"names":["menu_config","trade","instruments","assetIndex","tradingTimes","trade_messages","no_symbol","i18n","extractFilteredMarkets","trading_times_data","options","markets","trading_times","map","m","market","name","display_name","submarkets","sm","submarket","symbols","filter","sym","symbol","delay_amount","events","times","settlement","feed_license","length","extractChartableMarkets","refreshMenu","root","callback","Object","values","menu","addClass","$","growl","error","message","removeClass","s","i","pip","join","$menu","find","remove","append","on","e","a","target","text","$li","closest","attr","detach","position","collision"],"mappings":"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","file":"menu.js","sourcesContent":["﻿import $ from 'jquery';\nimport '../common/util';\nimport \"jquery-growl\";\n\n/* you can filter the symbols with the options parameter, for example:\n   options: {\n       filter: (sym) => (sym.feed_license !== 'realtime')\n   }\n*/\nconst menu_config = {\n   trade : '.trade a',\n   instruments : '.instruments a',\n   assetIndex : '.assetIndex',\n   tradingTimes : '.tradingTimes',\n};\n\nconst trade_messages = {\n   no_symbol : () => \"Trading options isn’t possible in your country.\".i18n(),\n};\n\nexport const extractFilteredMarkets = (trading_times_data, options) => {\n   if (trading_times_data) {\n      const markets = trading_times_data.trading_times.markets.map((m) => {\n         const market = {\n            name: m.name,\n            display_name: m.name\n         };\n         market.submarkets = m.submarkets.map((sm) => {\n            const submarket = {\n               name: sm.name,\n               display_name: sm.name\n            };\n            let symbols = sm.symbols;\n            if (options && options.filter) /* filter the symbols */\n               symbols = symbols.filter(options.filter);\n            submarket.instruments = symbols.map((sym) => {\n               return {\n                  symbol: sym.symbol,\n                  display_name: sym.name,\n                  delay_amount: sym.delay_amount || 0,\n                  events: sym.events,\n                  times: sym.times,\n                  settlement: sym.settlement,\n                  feed_license: sym.feed_license || 'realtime'\n               };\n            });\n            return submarket;\n         })\n         /* there might be a submarket (e.g \"Americas\") which does not have any symbols after filtering */\n            .filter(\n               (sm) => (sm.instruments.length > 0)\n            );\n         return market;\n      });\n\n      return markets;\n   }\n};\n\nexport const extractChartableMarkets = (trading_times_data) => {\n   return extractFilteredMarkets(trading_times_data, {\n      filter: (sym) => (sym.feed_license !== 'chartonly')\n   }) || [];\n};\n\nexport const refreshMenu = (root, markets, callback) => {\n   \n   if(markets.length == 0){\n      Object.values(menu_config).map( menu => $(menu).addClass('disabled'));\n      $.growl.error({message: trade_messages.no_symbol()});\n   } else if(markets.length == 3) {\n      $.growl.error({message: trade_messages.no_symbol()});\n   } else {\n      Object.values(menu_config).map( menu => $(menu).removeClass('disabled'));\n   }\n   const menu = `<ul>${\n      markets.map(m => `<li><div>${m.display_name}</div><ul>${\n         m.submarkets.map(s => `<li><div>${s.display_name}</div><ul>${\n            s.instruments.map(i => `<li symbol='${i.symbol}' pip='${i.pip}'><div>${i.display_name}</div></li>`).join('')\n         }</ul></li>`).join('')\n      }</ul></li>`).join('')\n   }</ul>`;\n   const $menu = $(menu);\n   root.find('> ul').menu('destroy').remove();\n   root.append($menu);\n   $menu.find('li[symbol]').on('click', (e,a) => {\n      const display_name = $(e.target).text();\n      const $li = $(e.target).closest('li');\n      const symbol = $li.attr('symbol');\n      const pip = $li.attr('pip');\n      $menu.detach();\n      root.append($menu);\n      callback(symbol, display_name, pip);\n   });\n   $menu.menu({ position: { collision: 'fit' } });\n}\n\nexport default {\n   extractChartableMarkets,\n   extractFilteredMarkets,\n   refreshMenu\n};\n"]}