{"version":3,"sources":["../../../../src/historical-data/historical-data.es6"],"names":["dialog","buildMenu","$root","instrumentName","callback","markets","length","_","delay","menu","map","m","display_name","submarkets","s","instruments","i","symbol","join","$menu","find","on","e","a","target","text","closest","attr","titlebar","append","buildDatetime","datetime","datepicker","changeMonth","numberOfMonths","changeYear","dateFormat","onSelect","change","update_time","beforeShow","input","inst","dpDiv","css","marginLeft","top","offset","left","zIndex","minDate","moment","utc","subtract","toDate","maxDate","timepicker","showCloseButton","tpDiv","marginTop","date","val","time","result","unix","createWindow","options","options_copy","html","$","extend","title","i18n","relativePosition","dialogClass","close","chart","actions","destroy","remove","resize","reflow","width","height","open","parent","promise","done","windows","createBlankWindow","show_chart","WebtraderCharts","chartWindow","addNewChart","events","anyChange","data","instrumentCode","start","update_track","track","module_id","is_unique","init","$menuLink","click","moveToTop","timePeriod","type","showInstrumentName","showOverlays","indicators","overlays","startOf"],"mappings":"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","file":"historical-data.js","sourcesContent":["import $ from 'jquery';\nimport windows from '../windows/windows';\nimport liveapi from '../websockets/binary_websockets';\nimport moment from 'moment';\nimport 'timepicker';\nimport 'highstock-release/modules/offline-exporting';\nimport 'common/util';\nimport 'webtrader-charts';\nimport html from 'text!./historical-data.html';\nimport _ from 'lodash';\nimport 'jquery-ui';\nimport 'css!./historical-data.css';\nimport {getMarketData} from '../instruments/instruments';\n\nlet dialog = null;\n\nconst buildMenu = ($root, instrumentName, callback) => {\n   const markets = getMarketData();\n   if(!markets || !markets.length){\n      _.delay(() => buildMenu($root, instrumentName, callback), 1000);\n      return;\n   }\n   const menu = `<ul>${\n      markets.map(m => `<li><div>${m.display_name}</div><ul>${\n         m.submarkets.map(s => `<li><div>${s.display_name}</div><ul>${\n            s.instruments.map(i => `<li symbol='${i.symbol}'><div>${i.display_name}</div></li>`).join('')\n         }</ul></li>`).join('')\n      }</ul></li>`).join('')\n   }</ul>`;\n   const $menu = $(menu);\n   $menu.find('li[symbol]').on('click', (e,a) => {\n      const display_name = $(e.target).text();\n      const symbol = $(e.target).closest('li').attr('symbol');\n      titlebar.find('.title').text(display_name);\n      callback(symbol, display_name);\n   });\n   const titlebar = $(`<div class='instrument-dropdown' ><div class='title'>${instrumentName}</div>`);\n   $root.closest('.ui-dialog').append(titlebar);\n   titlebar.append($menu);\n   $menu.menu();\n};\n\nconst buildDatetime = (dialog, $root, callback) => {\n    const datetime = $(`<div class='date-time'>\n                    <input type=\"text\" class=\"date\" tab-index=\"-1\" readonly></input>\n                    <input type=\"text\" class=\"time\" tab-index=\"-1\" value=\"00:00\" readonly></input>\n          </div>`);\n    $root.closest('.ui-dialog').append(datetime);\n    datetime.find('.date')\n       .datepicker({\n             changeMonth : true,\n             // showAnim: 'drop',\n             numberOfMonths: 1,\n             changeYear : true,\n             dateFormat : 'yy-mm-dd',\n             onSelect: function () { $(this).change(); update_time(); },\n             beforeShow: (input, inst) => {\n                _.delay(() => inst.dpDiv.css({\n                   marginLeft: '-60px',\n                   top: datetime.find('.date').offset().top + 32,\n                   left: datetime.find('.date').offset().left,\n                   zIndex: dialog.closest('.ui-dialog').css('z-index')*1 + 100\n                }));\n             },\n             minDate : moment.utc().subtract(1, 'years').toDate(),\n             maxDate : moment.utc().toDate(),\n         })\n         .datepicker('setDate', '0');\n\n     datetime.find('.time')\n         .timepicker({\n            showCloseButton : false,\n            beforeShow: (input, inst) => inst.tpDiv.css({\n                marginLeft: '-120px',\n                marginTop: '6px',\n                zIndex: 101,\n            }),\n            onSelect: function() { $(this).change(); update_time(); },\n         });\n    const update_time = () => {\n       const date = datetime.find('.date').val();\n       const time = datetime.find('.time').val();\n       const result = moment(`${date} ${time} +0000`, 'YYYY-MM-DD HH:mm Z').unix()*1;\n       callback && callback(result);\n    };\n};\nexport const createWindow = function(options) {\n    let options_copy = options;\n    const $root = $(html);\n    options = $.extend({\n        title: 'Historical Data For'.i18n(),\n        relativePosition: true,\n        dialogClass: 'historical-data-dialog',\n        close: function() {\n            chart.actions.destroy();\n            $(this).dialog('destroy').remove(); //completely remove this dialog\n            dialog = null;\n        },\n        resize: () => chart && chart.actions.reflow(),\n        width: 700,\n        height: 400,\n        open: function() {\n            const dialog = $(this);\n            $(this).parent().promise().done(() => chart.actions.reflow());\n        }\n    }, options);\n\n    dialog = windows.createBlankWindow($root, options);\n\n    let chart = null;\n    const show_chart = () => {\n       chart && chart.actions.destroy(); chart = null;\n       chart = WebtraderCharts.chartWindow.addNewChart($root, options_copy);\n       chart.actions.reflow();\n       chart.events.anyChange = () => {\n          options_copy = chart.data();\n       };\n    };\n    show_chart();\n\n    buildMenu($root, options_copy.instrumentName, (symbol, display_name) => {\n       options_copy.instrumentName = display_name;\n       options_copy.instrumentCode = symbol;\n       show_chart();\n    });\n    buildDatetime(dialog, $root, (start) => {\n       options_copy.start = start;\n       show_chart();\n    });\n \n    const update_track = dialog.track({\n        module_id: 'historicalData',\n        is_unique: true,\n        data: null\n    });\n\n    dialog.dialog('open');\n\n    return dialog;\n};\n\nexport const init = $menuLink => {\n   $menuLink.click(() => {\n      dialog && dialog.moveToTop() || createWindow({\n         instrumentCode: 'frxAUDJPY',\n         instrumentName: 'AUD/JPY',\n         timePeriod: '1d',\n         type: 'candlestick',\n         showInstrumentName: true,\n         showOverlays: false,\n         indicators: [],\n         overlays: [],\n         start: moment.utc().subtract(1, \"years\").startOf('day').unix()*1,\n      });\n   });\n};\n\nexport default { init };\n"]}