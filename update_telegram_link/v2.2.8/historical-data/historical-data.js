define(["exports","jquery","../windows/windows","../websockets/binary_websockets","moment","text!./historical-data.html","lodash","../instruments/instruments","timepicker","highstock-release/modules/offline-exporting","common/util","webtrader-charts","jquery-ui","css!./historical-data.css"],function(t,e,n,i,a,o,d,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.createWindow=void 0;var r=m(e),l=m(n),u=(m(i),m(a)),c=m(o),f=m(d);function m(t){return t&&t.__esModule?t:{default:t}}var p=null,v=t.createWindow=function(t){var n=t,e=(0,r.default)(c.default);t=r.default.extend({title:"Historical Data For".i18n(),relativePosition:!0,dialogClass:"historical-data-dialog",close:function(){a.actions.destroy(),(0,r.default)(this).dialog("destroy").remove(),p=null},resize:function(){return a&&a.actions.reflow()},width:700,height:400,open:function(){(0,r.default)(this);(0,r.default)(this).parent().promise().done(function(){return a.actions.reflow()})}},t),p=l.default.createBlankWindow(e,t);function i(){a&&a.actions.destroy(),a=null,(a=WebtraderCharts.chartWindow.addNewChart(e,n)).actions.reflow(),a.events.anyChange=function(){n=a.data()}}var a=null;i(),function t(e,n,a){var i=(0,s.getMarketData)();if(i&&i.length){var o="<ul>"+i.map(function(t){return"<li><div>"+t.display_name+"</div><ul>"+t.submarkets.map(function(t){return"<li><div>"+t.display_name+"</div><ul>"+t.instruments.map(function(t){return"<li symbol='"+t.symbol+"'><div>"+t.display_name+"</div></li>"}).join("")+"</ul></li>"}).join("")+"</ul></li>"}).join("")+"</ul>",d=(0,r.default)(o);d.find("li[symbol]").on("click",function(t,e){var n=(0,r.default)(t.target).text(),i=(0,r.default)(t.target).closest("li").attr("symbol");l.find(".title").text(n),a(i,n)});var l=(0,r.default)("<div class='instrument-dropdown' ><div class='title'>"+n+"</div>");e.closest(".ui-dialog").append(l),l.append(d),d.menu()}else f.default.delay(function(){return t(e,n,a)},1e3)}(e,n.instrumentName,function(t,e){n.instrumentName=e,n.instrumentCode=t,i()}),function(n,t,i){var a=(0,r.default)('<div class=\'date-time\'>\n                    <input type="text" class="date" tab-index="-1" readonly></input>\n                    <input type="text" class="time" tab-index="-1" value="00:00" readonly></input>\n          </div>');t.closest(".ui-dialog").append(a),a.find(".date").datepicker({changeMonth:!0,numberOfMonths:1,changeYear:!0,dateFormat:"yy-mm-dd",onSelect:function(){(0,r.default)(this).change(),e()},beforeShow:function(t,e){f.default.delay(function(){return e.dpDiv.css({marginLeft:"-60px",top:a.find(".date").offset().top+32,left:a.find(".date").offset().left,zIndex:+n.closest(".ui-dialog").css("z-index")+100})})},minDate:u.default.utc().subtract(1,"years").toDate(),maxDate:u.default.utc().toDate()}).datepicker("setDate","0"),a.find(".time").timepicker({showCloseButton:!1,beforeShow:function(t,e){return e.tpDiv.css({marginLeft:"-120px",marginTop:"6px",zIndex:101})},onSelect:function(){(0,r.default)(this).change(),e()}});var e=function(){var t=a.find(".date").val(),e=a.find(".time").val(),n=+(0,u.default)(t+" "+e+" +0000","YYYY-MM-DD HH:mm Z").unix();i&&i(n)}}(p,e,function(t){n.start=t,i()});p.track({module_id:"historicalData",is_unique:!0,data:null});return p.dialog("open"),p},h=t.init=function(t){t.click(function(){p&&p.moveToTop()||v({instrumentCode:"frxAUDJPY",instrumentName:"AUD/JPY",timePeriod:"1d",type:"candlestick",showInstrumentName:!0,showOverlays:!1,indicators:[],overlays:[],start:+u.default.utc().subtract(1,"years").startOf("day").unix()})})};t.default={init:h}});