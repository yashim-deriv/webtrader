define(["exports","lodash","jquery","rivets","moment","jquery-ui","jquery-sparkline","chosen","color-picker"],function(t,e,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.binders=t.formatters=t.bind=void 0;var o=d(e),u=d(n),a=d(r),s=d(i);function d(t){return t&&t.__esModule?t:{default:t}}function l(t){return 0===t||Boolean(t)}function f(t,e){var n=0;return t.replace(e,function(t){return 1===++n?t:""})}rivets._.View.prototype.observe=function(t,e){for(var n=this.models,r=0;-1!==(r=t.indexOf("."));)n=n[t.substring(0,r)],t=t.substring(r+1);this.adapters["."].observe(n,t,function(){return e(n[t])})},a.default.formatters.i18n=function(t){return"string"==typeof t?t.i18n():t},a.default.formatters.sanitize=function(t){return t.replace(/("|'|\&|\(|\)|\<|\>|\;)/g,"")},a.default.formatters.prop=function(t,e){return t&&t[e]},a.default.formatters["one-of"]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=e[0],i=1;i<e.length;++i)if(e[i]===r)return!0;return!1},a.default.formatters.trim=function(t){return o.default.trim(t)},a.default.formatters.negate=function(t){return!t},a.default.formatters.eq=function(t,e){return t===e},a.default.formatters["not-eq"]=function(t,e){return t!==e},a.default.formatters.or=function(t,e){return t||e},a.default.formatters["or-not"]=function(t,e){return t||!e},a.default.formatters.and=function(t,e){return t&&e},a.default.formatters["and-not"]=function(t,e){return t&&!e},a.default.formatters.gt=function(t,e){return e<t},a.default.formatters.lt=function(t,e){return t<e},a.default.formatters["has-value"]=l,a.default.formatters["format-price"]=function(t,e){return l(t)?formatPrice(t,e):void 0},a.default.formatters["add-comma"]=function(t,e){return t?addComma(t,e):void 0},a.default.formatters.capitalize={read:function(t){return o.default.capitalize(t)},publish:function(t){return t.toLowerCase()}},a.default.formatters["to-fixed"]=function(t,e){if(u.default.isNumeric(t)&&u.default.isNumeric(e))return(+t).toFixed(e||2)},a.default.formatters.notify=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=e[0],i=1;i<e.length;++i)o.default.defer(e[i],r);return r},a.default.formatters.checkbox={read:function(t,e){return o.default.trim(t," '\"")==e},publish:function(t,e,n){return o.default.trim(t?e:n," '\"")}},a.default.formatters.bind=function(t,e){return t.bind(void 0,e)},a.default.formatters.map=function(t,e){return o.default.map(t,e)},a.default.formatters.prepend=function(t,e){return e&&t?e+t:t},a.default.formatters.append=function(t,e){return e&&t?t+e:t},a.default.formatters.ternary=function(t,e,n){return t?e:n},a.default.formatters.currency=function(t,e){return t?({USD:"$",EUR:"€",CRC:"₡",GBP:"£",ILS:"₪",INR:"₹",JPY:"¥",KRW:"₩",NGN:"₦",PHP:"₱",PLN:"zł",PYG:"₲",THB:"฿",UAH:"₴",VND:"₫"}[e]||e)+t:t},a.default.formatters["utc-time"]=function(t){var e=new Date(1e3*t);return("00"+e.getUTCHours()).slice(-2)+":"+("00"+e.getUTCMinutes()).slice(-2)+":"+("00"+e.getUTCSeconds()).slice(-2)},a.default.formatters.moment=function(t,e){return e=e||"YYYY-MM-DD HH:mm:ss",t&&s.default.utc(1e3*t).format(e)},a.default.formatters["moment-humanize"]=function(t,e){if(t&&e){var n="",r=e-t,i=s.default.duration(r,"seconds");return 0<i.days()&&(n+=" "+i.days()+" "+(1<i.days()?"days":"day")),0<i.hours()&&(n+=" "+i.hours()+" "+(1<i.hours()?"hours":"hour")),0<i.minutes()&&(n+=" "+i.minutes()+" "+(1<i.minutes()?"minutes":"minute")),0<i.seconds()&&r<600&&(n+=" "+i.seconds()+" "+(1<i.seconds()?"seconds":"second")),o.default.trim(n).i18n()}},a.default.formatters["bold-last-character"]=function(t){return(t+="").substring(0,t.length-1)+"<strong>"+o.default.last(t)+"</strong>"},a.default.formatters["percent-of"]=function(t,e){if(null!=t&&e){var n=(100*(t-e)/e).toFixed(2);return 0<n?"+"+n+"%":n+"%"}},a.default.formatters.length=function(t){return t.length},a.default.formatters.debounce=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:250;return clearTimeout(e._timer_notify),e._timer_notify=setTimeout(e.bind(void 0,t),n),t},a.default.formatters.filter=function(t,e,n){return o.default.filter(t,function(t){return t[e]===n})},a.default.binders.selectmenu={priority:101,publishes:!0,bind:function(t){var e=this.publish,n=(0,u.default)(t);n.selectmenu({classes:{"ui-selectmenu-button":"ui-selectmenu-button ui-state-default"},change:function(){e(n.val()),n.trigger("change")}})},unbind:function(t){return(0,u.default)(t).selectmenu("destroy")},routine:function(t,e){(t=(0,u.default)(t)).val(e),0<t.find("option[value='"+e+"']").length&&t.selectmenu("refresh")}},a.default.binders["is-valid-number"]={priority:100,publishes:!0,bind:function(t){var n=this.keypath.split(".")[1],r=this.model,i=(0,u.default)(t),a=/^(?!0\d)\d*(\.\d{1,4})?$/;i.on("input",function(){var t=i.val(),e=a.test(t);r[n]=e&&""!==t})},unbind:function(){},routine:function(){}},a.default.binders["dom-*"]=function(t,e){var n=this.args[0];e&&setTimeout(function(){return t[n]()},0)},a.default.binders["selectmenu-*"]=function(t,e){this.args[0]={appendto:"appendTo"}[this.args[0]]||this.args[0],(0,u.default)(t).selectmenu("option",this.args[0],e)},a.default.binders["selectmenu-css-*"]=function(t,e){(0,u.default)(t).selectmenu("menuWidget").css(this.args[0],e)},a.default.binders.selectrefresh={priority:99,routine:function(t,e){t=(0,u.default)(t),"string"==typeof e&&(t.val(e),0===t.find("option[value='"+e+"']").length)||t.selectmenu("refresh")}},a.default.binders.chosen={priority:100,publishes:!0,bind:function(t){var e=this.publish,n=(0,u.default)('<div class="webtrader-chosen-disable chosen-disable"></div>');n.click(function(t){return t.stopPropagation()}),(0,u.default)(t).chosen({width:(0,u.default)(t).css("width")}).change(function(){e((0,u.default)(this).val())}),(0,u.default)(t).next().prepend(n)},unbind:function(t){return(0,u.default)(t).chosen("destroy")}},a.default.binders.chosenrefresh=function(t){return(0,u.default)(t).trigger("chosen:updated")},a.default.binders.chosendisable=function(t,e){var n=(0,u.default)(t).next(),r=n.find(".chosen-choices input"),i=n.find(".chosen-drop"),a=n.find(".webtrader-chosen-disable");e?(r.attr("disabled",e),i.hide(),a.addClass("chosen-disable")):(r.removeAttr("disabled"),i.show(),a.removeClass("chosen-disable"))},u.default.widget("ui.webtrader_spinner",u.default.ui.spinner,{_buttonHtml:function(){function t(t,e,n,r,i){return r=r||"5px","<button step='"+n+"' class='ui-spinner-button ui-spinner-"+t+"' style='"+(i="right: "+(i||"0px")+";")+(r="border-radius: 0 "+("up"==t?r+" 0":"0 "+r)+" 0")+"'><span class='ui-icon "+(e="ui-icon-"+e+"-1-"+("up"===t?"n":"s"))+"'>&#9650;</span></button>"}var e="";return e+=t("up","triangle",this.options.step_big||this.options.step,"5px"),e+=t("down","triangle","-"+(this.options.step_big||this.options.step),"5px")}}),a.default.binders.spinner={priority:98,publishes:!0,bind:function(t){this.model;var e=this.publish,n=(0,u.default)(t);n.webtrader_spinner({stop:function(){var t=n.val();e(+t)},spin:function(t){var e=(0,u.default)(t.currentTarget).attr("step")+"",n=(e.split(".")[1]||[]).length;value=+(0,u.default)(this).val()+ +e,(0,u.default)(this).val(value.toFixed(n)),t.preventDefault()},step:n.attr("step")||1,step_big:n.attr("step-big")||null})},unbind:function(t){return(0,u.default)(t).webtrader_spinner("destroy")},routine:function(t,e){return(0,u.default)(t).webtrader_spinner("value",+e)}},a.default.binders["input-enter"]={priority:93,publishes:!1,routine:function(e,n){(0,u.default)(e).keyup(function(t){13==t.keyCode&&n(e)})},function:!0},a.default.binders["spinner-*"]=function(t,e){(0,u.default)(t).webtrader_spinner("option",this.args[0],e)},a.default.binders["dialog-*"]=function(t,e){(0,u.default)(t).dialog("option",this.args[0],e)},a.default.binders["color-picker"]={priority:96,publishes:!0,bind:function(t){var e=(0,u.default)(t),n=this.publish,r=(this.model.value,(0,u.default)('<div style="width:100%;"/>'));e.after(r),e.colorpicker({showOn:"alt",altField:r,position:{my:"left-100 bottom+5",of:"element",collision:"fit"},parts:["map","bar"],alpha:!0,layout:{map:[0,0,2,2],bar:[2,0,1,2]},colorFormat:"RGBA",part:{map:{size:128},bar:{size:128}},select:function(t,e){return n(e)}}),setTimeout(function(){parent=e.scrollParent(),parent.scroll(function(){return e.colorpicker("close")})},1e3)},unbind:function(){},routine:function(){}},a.default.binders.slider={priority:95,publishes:!0,bind:function(t){var e=(0,u.default)(t),n=(0,u.default)('<div class="ui-slider-handle"></div>');e.append(n);this.publish;var r=this.model;e.slider({step:+e.attr("step")||1,min:void 0===e.attr("min")?1:+e.attr("min"),max:+e.attr("max")||100,create:function(){n.text((0,u.default)(this).slider("value"))},slide:function(t,e){n.text(e.value),r.value=+e.value}})},unbind:function(t){return(0,u.default)(t).slider("destroy")},routine:function(t,e){(0,u.default)(t).slider("value",e),(0,u.default)(t).find("> div").text(e)}},a.default.binders.datepicker_mindate={routine:function(t,e){return(0,u.default)(t).datepicker("option","minDate",e)}},a.default.binders.datepicker={priority:94,publishes:!0,bind:function(t){var e=(0,u.default)(t),n=this.publish,r=this.model,i={marginTop:e.attr("marginTop")||"0px",marginLeft:e.attr("marginLeft")||"0px"},a={showOn:r.showOn||"focus",numberOfMonths:+e.attr("numberOfMonths")||2,dateFormat:r.dateFormat||"yy-mm-dd",showAnim:r.showAnim||"drop",showButtonPanel:void 0===r.showButtonPanel||r.showButtonPanel,changeMonth:r.changeMonth||!0,changeYear:r.changeYear||!0,onSelect:function(){(0,u.default)(this).change()},beforeShow:function(t,e){return e.dpDiv.css(i)},closeText:"Done".i18n(),currentText:"Today".i18n()};r.yearRange?a.yearRange=r.yearRange:(a.maxDate=r.maxDate||null,a.minDate=r.minDate||0);e.datepicker(a);e.on("change",function(){var t=e.val();n(t),e.blur()}),u.default.datepicker._gotoToday=function(t){(0,u.default)(t).datepicker("setDate",new Date).change().datepicker("hide")}},unbind:function(t){return(0,u.default)(t).datepicker("destroy")},routine:function(t,e){return(0,u.default)(t).datepicker("setDate",e)}},a.default.binders.timepicker={priority:93,publishes:!0,bind:function(t){function e(){return!0}var n=(0,u.default)(t),r=this.publish,i=this.model,a={marginTop:n.attr("marginTop")||"0px",marginLeft:n.attr("marginLeft")||"0px"};n.on("change",function(){r(n.val()),n.blur()}),n.timepicker({showPeriod:i.showPeriod||!1,showLeadingZero:i.showLeadingZero||!0,showCloseButton:i.showCloseButton||!0,showNowButton:i.showNowButton||!1,onHourShow:i.onHourShow||e,onMinuteShow:i.onMinuteShow||e,beforeShow:function(t,e){return e.tpDiv.css(a)},onSelect:function(){(0,u.default)(this).change()},hourText:"Hour".i18n(),minuteText:"Minute".i18n(),amPmText:["AM".i18n(),"PM".i18n()],closeButtonText:"Done".i18n(),nowButtonText:"Now".i18n(),deselectButtonText:"Deselect".i18n()})},unbind:function(t){return(0,u.default)(t).timepicker("destroy")},routine:function(t,e){return(0,u.default)(t).val(e)}},a.default.binders["jq-class"]={priority:92,routine:function(t,e){t=(0,u.default)(t);var n=(0,u.default)("#"+t.attr("id")+"-menu");n.removeClass(t.data("jq-class")),t.data({"jq-class":e}),n.addClass(e)}},a.default.binders["input-default-btn"]=function(t,e){(0,u.default)(t).keyup(function(t){13==t.keyCode&&(0,u.default)(e).click()})},a.default.binders["css-*"]=function(t,e){var n={};n[this.args[0]]=e,(0,u.default)(t).css(n)},u.default.fn.getHiddenOffsetWidth=function(){var t=(0,u.default)(this).clone().appendTo("body"),e=t.outerWidth();return t.remove(),e},a.default.binders["scale-font-size"]=function(t,e){for(var n=14,r=(0,u.default)(t);t.style.fontSize=n+"px",--n,r.getHiddenOffsetWidth()>+e;);},a.default.binders.show=function(t,e){return t.style.display=e?"":"none",e},a.default.binders.visible=function(t,e){return t.style.visibility=e?"visible":"hidden",e},a.default.binders.disabled=function(t,e){e?(0,u.default)(t).attr("disabled","disabled"):(0,u.default)(t).removeAttr("disabled")},a.default.binders["auto-scroll-bottom"]={priority:91,routine:function(t){(0,u.default)(t).animate({scrollTop:t.scrollHeight-(0,u.default)(t).height()},"slow")}},a.default.binders["barrier-format"]={priority:3001,routine:function(t){function e(){var t=n.val(),e="";(t.startsWith("+")||t.startsWith("-"))&&(e=t[0]),t=e+(t=(t=f(t,/\./g)).replace(/[^\d.]/g,"")),n.val(t),n.trigger("change")}var n=(0,u.default)(t);t._listener&&n.off("input",t._listener),t._listener=e,n.on("input",e)},getValue:function(t){return t.value}},a.default.binders["number-format"]={priority:3002,routine:function(t,r){function e(){var t,e,n=i.val();n=(n=f(n,/\./g)).replace(/[^\d.]/g,""),t=(""+n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/),e=0,t&&(e=Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0))),r<e&&(n=(+n).toFixed(r)),i.val(n),i.trigger("change")}var i=(0,u.default)(t);t._listener&&i.off("input",t._listener),t._listener=e,i.on("input",e)}},a.default.binders["attr-*"]={priority:1e4,routine:function(t,e){t.setAttribute(this.args[0],e)}},a.default.binders.sparkline=function(t,e){var n=(0,u.default)(t),r={type:"line",lineColor:"#606060",fillColor:!1,spotColor:"#00f000",minSpotColor:"#f00000",maxSpotColor:"#0000f0",highlightSpotColor:"#ffff00",highlightLineColor:"#000000",spotRadius:1.25};setTimeout(function(){n.sparkline(e,r),e&&e.length?n.show():n.hide()},0)},a.default.binders["indicative-color"]=function(t,e){var n=+(t._perv_indicative_color||0);u.default.isNumeric(e)?n!=+e&&(0,u.default)(t).css({color:n<+e?"#02920e":"#d71818"}):(0,u.default)(t).css({color:"black"}),t._perv_indicative_color=e};rivets.components["price-spinner"]={static:["class","min"],template:function(){return'<span class="ui-spinner ui-widget ui-widget-content ui-corner-all" rv-attr-value="data.value">\n               <input rv-class="data.class" type="text" rv-value="data.value" rv-decimal-round="data.decimals | or 5" no-symbol="no-symbol" />\n             </span>'},initialize:function(t,e){var i,a,u;return i=this,a=e,u=["data.value"],setTimeout(function(){for(var t=function(t){var e=u[t],n=o.default.last(e.split(".")),r=i.observers[n];r&&(r.options.adapters["."].observe(r.target,o.default.last(r.keypath.split(".")),function(){var t=r.target[o.default.last(r.keypath.split("."))];a[n]=t}),i.componentView.observe(e,function(t){return r.setValue(t)}))},e=0;e<u.length;++e)t(e)},0),{data:e}}},rivets.components["loader-dark"]={template:function(){return'<div class="barspinner dark">\n      <div class="rect1"></div>\n      <div class="rect2"></div>\n      <div class="rect3"></div>\n      <div class="rect4"></div>\n      <div class="rect5"></div>\n    </div>'},initialize:function(){}};var c=t.bind=function(t,e){return a.default.bind(t,e)},p=t.formatters=a.default.formatters,h=t.binders=a.default.binders;t.default={bind:c,formatters:p,binders:h}});