(function(){function i(t,e,s,i){return new h(t,e,s,i)}function h(t,e,s,i){this.options=i||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=s,this.objectPath=[],this.update=this.update.bind(this),this.parse(),a(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function a(t){return"object"==typeof t&&null!==t}function o(t){throw new Error("[sightglass] "+t)}i.adapters={},h.tokenize=function(t,e,s){var i,h,a=[],o={i:s,path:""};for(i=0;i<t.length;i++)h=t.charAt(i),~e.indexOf(h)?(a.push(o),o={i:h,path:""}):o.path+=h;return a.push(o),a},h.prototype.parse=function(){var t,e,s=this.interfaces();s.length||o("Must define at least one adapter interface."),e=~s.indexOf(this.keypath[0])?(t=this.keypath[0],this.keypath.substr(1)):(void 0===(t=this.options.root||i.root)&&o("Must define a default root adapter."),this.keypath),this.tokens=h.tokenize(e,s,t),this.key=this.tokens.pop()},h.prototype.realize=function(){var s,i=this.obj,h=!1;return this.tokens.forEach(function(t,e){a(i)?(void 0!==this.objectPath[e]?i!==(s=this.objectPath[e])&&(this.set(!1,t,s,this.update),this.set(!0,t,i,this.update),this.objectPath[e]=i):(this.set(!0,t,i,this.update),this.objectPath[e]=i),i=this.get(t,i)):(!1===h&&(h=e),(s=this.objectPath[e])&&this.set(!1,t,s,this.update))},this),!1!==h&&this.objectPath.splice(h),i},h.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(a(this.target)&&this.set(!1,this.key,this.target,this.callback),a(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,(this.value()instanceof Function||this.value()!==e)&&this.callback())},h.prototype.value=function(){if(a(this.target))return this.get(this.key,this.target)},h.prototype.setValue=function(t){a(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},h.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},h.prototype.set=function(t,e,s,i){var h=t?"observe":"unobserve";this.adapter(e)[h](s,e.path,i)},h.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(i.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},h.prototype.adapter=function(t){return this.options.adapters[t.i]||i.adapters[t.i]},h.prototype.unobserve=function(){var s;this.tokens.forEach(function(t,e){(s=this.objectPath[e])&&this.set(!1,t,s,this.update)},this),a(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=i}):this.sightglass=i}).call(this);