{"version":3,"sources":["../../../../src/selfexclusion/selfexclusion.es6"],"names":["win","timerHandlerForSessionTimeout","loginTime","limits","i18n","settingsData","max_balance","max_turnover","max_losses","max_7day_turnover","max_7day_losses","max_30day_turnover","max_30day_losses","max_open_bets","session_duration_limit","exclude_until","has_exclude_until","is_iom_malta","is_gamstop_client","timeout_until_date","timeout_until_time","binary_url_contact","getBinaryUrl","trimString","event","scope","$el","target","decimals","currencyFractionalDigits","length","attr","r","RegExp","val","toString","match","field","update","data","message","time_out","time","add","format","isAfter","push","timeout_until","unix","$","each","index","value","set","moment","utc","isBefore","startOf","indexOf","name","limit","undefined","forEach","msg","i","growl","error","fixed","confirm","window","liveapi","send","then","response","notice","logoutBasedOnExcludeDateAndTimeOut","setOrRefreshTimer","refreshData","catch","err","init_win","require","Promise","res","div","html","find","datepicker","dateFormat","minDate","toDate","maxDate","timepicker","timeFormat","windows","createBlankWindow","title","dialogClass","width","minHeight","height","destroy","appendTo","rv","bind","authorize","local_storage","get","accountstatus","recheckStatus","_","defer","valueOf","get_self_exclusion","country_status","getCountryStatus","has_iom_malta","has_uk","console","test","landing_company_name","country","isUndefined","isNull","isFinite","toNumber","clearTimeout","logoutAfter_ms","now","Math","pow","setTimeout","warning","invalidate","logout","dialog","addClass","events","on","cached","is_virtual","removeClass","init","$menuLink","click","hasClass","moveToTop"],"mappings":"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","file":"selfexclusion.js","sourcesContent":["/**\n * Created by arnab on 4/5/16.\n */\nimport $ from \"jquery\";\nimport windows from \"windows/windows\";\nimport liveapi from \"websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport rv from \"common/rivetsExtra\";\nimport moment from \"moment\";\nimport html from \"text!selfexclusion/selfexclusion.html\";\nimport \"jquery-growl\";\nimport \"common/util\";\nimport accountstatus from 'accountstatus/accountstatus';\n\n\nlet win = null,\n    timerHandlerForSessionTimeout = null,\n    loginTime = null;\nconst limits = {\n    \"max_balance\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Maximum balance\".i18n()\n    },\n    \"max_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily turnover limit\".i18n()\n    },\n    \"max_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"Daily limit on losses\".i18n()\n    },\n    \"max_7day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day turnover limit\".i18n()\n    },\n    \"max_7day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"7-day limit on losses\".i18n()\n    },\n    \"max_30day_turnover\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day turnover limit\".i18n()\n    },\n    \"max_30day_losses\": {\n        \"limit\": 99999999999999999999,\n        \"set\": false,\n        \"name\": \"30-day limit on losses\".i18n()\n    },\n    \"max_open_bets\": {\n        \"limit\": 101,\n        \"set\": false,\n        \"name\": \"Maximum open positions\".i18n()\n    },\n    \"session_duration_limit\": {\n        \"limit\": 60480,\n        \"set\": false,\n        \"name\": \"Session duration limit\".i18n()\n    },\n    \"exclude_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Exclude time\".i18n()\n    },\n    \"timeout_until\": {\n        \"limit\": null,\n        \"set\": false,\n        \"name\": \"Time out until\".i18n()\n    }\n};\n\nconst settingsData = {\n    max_balance: null,\n    max_turnover: null,\n    max_losses: null,\n    max_7day_turnover: null,\n    max_7day_losses: null,\n    max_30day_turnover: null,\n    max_30day_losses: null,\n    max_open_bets: null,\n    session_duration_limit: null,\n    exclude_until: null,\n    has_exclude_until: null,\n    is_iom_malta: null,\n    is_gamstop_client: null,\n    timeout_until_date: null,\n    timeout_until_time: null,\n    binary_url_contact: getBinaryUrl('contact.html'),\n    trimString: (event, scope) => {\n        const $el = $(event.target),\n            decimals = currencyFractionalDigits(),\n            length = $el.attr('maxlength'),\n            r = new RegExp(`[\\\\d]{0,20}(\\\\.[\\\\d]{1,${decimals}})?`, \"g\"),\n            val = ($el.val().toString().match(r) || [])[0],\n            field = $el.attr('rv-value');\n        scope[field] = val;\n    },\n    update: function(event, scope) {\n\n        const data = { \"set_self_exclusion\": 1 };\n        let message = [];\n\n        if (scope.timeout_until_date) {\n\n            const time_out = moment(scope.timeout_until_date);\n            if (scope.timeout_until_time) {\n                const time = moment(scope.timeout_until_time, \"HH:mm\");\n                time_out.add(time.format('HH'), 'hours')\n                    .add(time.format('mm'), 'minutes');\n            }\n            if (time_out.isAfter(moment().add(6, \"weeks\"))) {\n                message.push(\"Please enter a value less than 6 weeks for time out until.\".i18n());\n            }\n            if (!time_out.isAfter(moment())) {\n                message.push(\"Exclude time must be after today.\".i18n());\n            }\n            scope.timeout_until = time_out.unix();\n        } else {\n            if (scope.timeout_until_time) {\n                message.push(\"Please select a date for time out until.\".i18n());\n            }\n        }\n\n\n        //validation\n        $.each(limits, function(index, value) {\n            scope[index] = scope[index] && scope[index].toString();\n            if (scope[index] || value.set) {\n                if (index === \"exclude_until\") {\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isBefore(moment.utc().startOf('day').add(6, \"months\"))){\n                        message.push(\"Exclude until time cannot be less than 6 months.\".i18n());\n                        return;\n                    }\n                    if(moment.utc(scope.exclude_until, \"YYYY-MM-DD\").isAfter(moment.utc().startOf('day').add(5, \"years\"))){\n                        message.push(\"Exclude until time cannot be more than 5 years.\".i18n());\n                        return;\n                    }\n                }\n                if(scope[index] && scope[index].indexOf(\"e\")!==-1) {\n                    message.push(\"Please enter a valid value for \".i18n() + value.name);\n                    return;\n                }\n                if (!scope[index] || scope[index] <= 0 || (value.limit && scope[index] > value.limit)) {\n                    message.push(\"Please enter a value between 0 and \".i18n() + value.limit + \" for \".i18n() + value.name);\n                    return;\n                }\n\n                data[index] = scope[index];\n            } else {\n                scope[index] = undefined;\n            }\n        });\n\n        if (message.length > 0) {\n            message.forEach(function(msg, i) {\n                $.growl.error({ message: msg, fixed: true });\n            })\n            return;\n        }\n        if (data.timeout_until || data.exclude_until) {\n            const confirm = window.confirm('When you click \"Ok\" you will be excluded from trading on the site until the selected date.'.i18n());\n            if (confirm == false) {\n                return;\n            }\n        }\n\n        liveapi.send(data)\n            .then(function(response) {\n                $.growl.notice({ message: 'Your changes have been updated'.i18n() });\n                logoutBasedOnExcludeDateAndTimeOut();\n                setOrRefreshTimer();\n                refreshData();\n            })\n            .catch(function(err) {\n                $.growl.error({ message: err.message, fixed: true });\n            });\n    }\n};\n\nconst init_win = function() {\n    require([\"css!selfexclusion/selfexclusion.css\"]);\n    return new Promise(function(res) {\n        const div = $(html).i18n();\n        div.find(\".datepicker\").datepicker({\n            dateFormat: 'yy-mm-dd',\n            minDate: moment.utc().toDate(),\n            maxDate: moment.utc().add(6, \"weeks\").toDate()\n        });\n        div.find(\".timepicker\").timepicker({\n            timeFormat: 'HH:MM'\n        });\n        win = windows.createBlankWindow($('<div/>'), {\n            title: 'Self-Exclusion Facilities'.i18n(),\n            dialogClass: 'self-exclusion',\n            width: 900,\n            minHeight: 500,\n            height: 500,\n            'data-authorized': 'true',\n            destroy: function() {\n                win = null;\n            }\n        });\n        div.appendTo(win);\n        rv.bind(div[0], settingsData);\n        refreshData();\n        res();\n    });\n};\n\nfunction logoutBasedOnExcludeDateAndTimeOut() {\n    const authorize = local_storage.get('authorize');\n    if (settingsData.exclude_until) {\n        if (moment.utc(settingsData.exclude_until, 'YYYY-MM-DD').isAfter(moment.utc().startOf('day'))) {\n            local_storage.set('excluded', true);\n            accountstatus.recheckStatus(authorize);\n            _.defer(function() {\n                $.growl.error({ message: 'You have excluded yourself until '.i18n() + settingsData.exclude_until });\n            });\n        }\n    } else if (settingsData.timeout_until) {\n        if (moment.unix(settingsData.timeout_until).isAfter(moment().unix().valueOf())) {\n            local_storage.set('excluded', true);\n            accountstatus.recheckStatus(authorize);\n            $.growl.error({ message: 'You have excluded yourself until '.i18n() + moment.unix(settingsData.timeout_until).utc().format(\"YYYY-MM-DD HH:mm\") + \"GMT\" });\n        }\n    } else {\n        local_storage.set('excluded', false);\n        accountstatus.recheckStatus(authorize);\n    }\n}\n\nconst refreshData = function() {\n    $.growl.notice({ message: 'Loading self-exclusion settings.'.i18n() });\n    return liveapi\n        .send({ get_self_exclusion: 1 })\n        .then(function(response) {\n            if (response.get_self_exclusion) {\n                $.each(limits, function(index, value) {\n                    settingsData[index] = response.get_self_exclusion[index];\n                    if (response.get_self_exclusion[index]) {\n                        limits[index].limit = response.get_self_exclusion[index];\n                        limits[index].set = true;\n                    }\n                });\n                settingsData.has_exclude_until = response.get_self_exclusion.exclude_until;\n                const country_status = getCountryStatus();\n                settingsData.is_iom_malta = country_status.has_iom_malta;\n                settingsData.is_gamstop_client = country_status.has_uk && country_status.has_iom_malta;\n                logoutBasedOnExcludeDateAndTimeOut();\n            }\n        })\n        .catch(function(err) {\n            $.growl.error({ message: err.message, fixed: true });\n            console.error(err);\n        });\n};\n\nconst getCountryStatus = function() {\n    const authorize = local_storage.get('authorize');\n    return {\n        has_iom_malta: /iom|malta/.test(authorize.landing_company_name),\n        has_uk: /gb/.test(authorize.country),\n    };\n}\n\nconst setOrRefreshTimer = function() {\n\n    if (_.isUndefined(settingsData.session_duration_limit) || _.isNull(settingsData.session_duration_limit) || !_.isFinite(_.toNumber(settingsData.session_duration_limit))) return;\n\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout);\n    let logoutAfter_ms = settingsData.session_duration_limit * 60 * 1000;\n    //reduce time elapsed since login\n    logoutAfter_ms -= _.now() - loginTime;\n    //setTimeout works with 32 bit value. Anything more than that does not work. 32 bit value is around 49 days\n    //User cannot be active on website for 49 days, so we are setting the session time out to 49 days max\n    if (logoutAfter_ms > Math.pow(2, 32)) { logoutAfter_ms = Math.pow(2, 32); }\n    timerHandlerForSessionTimeout = setTimeout(function() {\n        $.growl.warning({ message: 'Logging out because of self-exclusion session time out!'.i18n() });\n        liveapi.invalidate();\n    }, logoutAfter_ms);\n\n};\n\nconst logout = function() {\n    if (win) win.dialog('destroy');\n    win = null;\n    if (timerHandlerForSessionTimeout) clearTimeout(timerHandlerForSessionTimeout)\n    timerHandlerForSessionTimeout = null;\n    loginTime = null;\n    settingsData.max_balance = null;\n    settingsData.max_turnover = null;\n    settingsData.max_losses = null;\n    settingsData.max_7day_turnover = null;\n    settingsData.max_7day_losses = null;\n    settingsData.max_30day_turnover = null;\n    settingsData.max_30day_losses = null;\n    settingsData.max_open_bets = null;\n    settingsData.session_duration_limit = null;\n    settingsData.exclude_until = null;\n    $(\".resources a.selfexclusion\").addClass('disabled');\n};\n\nliveapi.events.on('login', function(data) {\n    liveapi.cached.authorize()\n        .then(function(data) {\n            if (!data.authorize.is_virtual) {\n                loginTime = _.now();\n                refreshData().then(function() {\n                    setOrRefreshTimer();\n                });\n                $(\"#nav-menu a.selfexclusion\").removeClass('disabled');\n            } else {\n                logout();\n            }\n        })\n        .catch(function(err) {\n            logout();\n        });\n});\nliveapi.events.on('logout', logout);\n\nexport const init = function($menuLink) {\n    $menuLink.click(function() {\n        if (!$(this).hasClass('disabled')) {\n            liveapi.cached.authorize()\n                .then(function() {\n                    if (!win) {\n                        init_win().then(function() {\n                            win.dialog('open');\n                        });\n                    } else {\n                        refreshData();\n                        win.moveToTop();\n                    }\n                })\n                .catch(function(err) {\n                    console.error(err);\n                });\n        }\n    });\n}\n\nexport default {\n    init\n}\n"]}