define(["exports","jquery","windows/windows","websockets/binary_websockets","navigation/menu","lodash","moment","../common/marketUtils","datatables","jquery-growl","common/util"],function(e,t,a,n,s,i,r,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var v=o(t),b=o(a),l=o(n),k=o(s),u=(o(i),o(r));function o(e){return e&&e.__esModule?e:{default:e}}var d=null,c=null,m=e.init=function(e){require(["css!tradingtimes/tradingTimes.css"]),e.click(function(){c?c.moveToTop():((c=b.default.createBlankWindow((0,v.default)("<div/>"),{title:"Trading Times".i18n(),dialogClass:"tradingTimes",width:800,height:400})).track({module_id:"tradingTimes",is_unique:!0,data:null}),c.dialog("open"),require(["text!tradingtimes/tradingTimes.html"],f))})},f=function(e){var f=(e=(0,v.default)(e).i18n()).filter(".trading-times-sub-header");d=e.filter("table"),e.appendTo(c),(d=d.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4]}],paging:!1,ordering:!1,searching:!0,processing:!0})).parent().addClass("hide-search-input"),d.api().columns().every(function(){var e=this;(0,v.default)("input",this.header()).on("keyup change",function(){e.search()!==this.value&&e.search(this.value).draw()})});function t(t){function m(e,t,a){var n=e.getRowsFor(t,a);d.api().rows().remove(),d.api().rows.add(n),d.api().draw()}function n(e,n){var s,a,i,r=(s=k.default.extractFilteredMarkets(e[0]),a=[],i={},(s=s||[]).forEach(function(t){a.push(t.display_name),i[t.display_name]=[],t.submarkets.forEach(function(e){i[t.display_name].push(e.display_name)})}),{market_names:a,submarket_names:i,getRowsFor:function(t,a){var e=s.filter(function(e){return e.display_name==t})[0];return(e&&e.submarkets.filter(function(e){return e.display_name==a})[0].instruments||[]).map(function(e){return[e.display_name,e.times.open[0],e.times.close[0],e.times.settlement||e.settlement||"-",e.events&&0<e.events.length?e.events.map(function(e){return e.descrip+": "+e.dates}).join("<br>"):"-"]})}}),t=n,l=(0,p.getObjectMarketSubmarkets)(t),u=(0,p.getSortedMarkets)(t);if(!v.default.isEmptyObject(l)){if(null==g){var o=(0,v.default)("<select />");o.appendTo(f),(g=b.default.makeSelectmenu(o,{list:u,inx:0})).off("selectmenuchange",c),g.on("selectmenuchange",c)}else g.update_list(u),g.off("selectmenuchange",c),g.on("selectmenuchange",c);if(null==h){var d=(0,v.default)("<select />");d.appendTo(f),(h=b.default.makeSelectmenu(d,{list:(0,p.getSortedSubmarkets)(Object.keys(l[g.val()])),inx:0,changed:null})).off("selectmenuchange",c),h.on("selectmenuchange",c)}else h.update_list((0,p.getSortedSubmarkets)(Object.keys(l[g.val()]))),h.off("selectmenuchange",c),h.on("selectmenuchange",c);m(r,g.val(),h.val())}function c(){var e=(0,v.default)(this).val(),t=n;if((l=(0,p.getObjectMarketSubmarkets)(t))[e]){var a=Object.keys(l[e]);h.update_list((0,p.getSortedSubmarkets)(a))}m(r,g.val(),h.val())}}function a(){var e={trading_times:t},a=(0,v.default)("#"+d.attr("id")+"_processing");a.show(),Promise.all([l.default.cached.send(e)]).then(function(t){l.default.send({active_symbols:"brief"}).then(function(e){n(t,e.active_symbols)}).catch(function(e){v.default.growl.error({message:e.message})}),a.hide()}).catch(function(e){v.default.growl.error({message:e.message}),a.hide()})}a(),require(["websockets/binary_websockets"],function(e){e.events.on("login",a),e.events.on("logout",a)})}var g=null,h=null;t(u.default.utc().format("YYYY-MM-DD"));var a=u.default.utc().add(1,"years").toDate();c.addDateToHeader({title:"Date: ",date:u.default.utc().toDate(),changed:t,maxDate:a})};e.default={init:m}});